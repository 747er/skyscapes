<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
{{ 'calendar.css' | asset_url | stylesheet_tag }}

<div class="shopify-section spaced-section" id="calendar-section">
  <div id="experiences" class="page-width">
    <div class="workshop-list">
      {%- for product in collection.products -%}
        {% capture coming_start %}{{product.metafields.tour_info.start_date}}{% endcapture %}
        {% capture coming_end %}{{product.metafields.tour_info.end_date}}{% endcapture %}
        {%- if product.metafields.tour_info.guides.value != blank -%}
          {% assign guide_list = product.metafields.tour_info.guides.value | split: ',' %}
        {%- endif -%}
        {% assign today_date = 'now' | date: '%s' %}
        {% assign pre_start = coming_start | date: '%s' %}
        {% assign pre_end = coming_end | date: '%s' %}

        <div class="cal-card-wrap">
          <div class="cal-card" id="tour-{{ forloop.index | plus: 1 }}">
            <div class="card-picture">
              <div class="image-wrap">
                <img
                  src="{{ product.featured_image.src | img_url: '600x' }}"
                  alt="{{ product.title }}"
                  class="cal-card-picture"
                  data-tour="{{ forloop.index | plus: 1 }}">
              </div>
            </div>
            <div class="cal-content">
              <div class="cal-card-title">{{ product.title }}{% unless product.available %}
                  <span style="color: white;">(FULL!)</span>
                {% endunless %}
              </div>

              <div class="cal-kv-wrap">
                <div class="cal-key">
                  Dates:
                </div>
                <div class="cal-value">
                  {{ pre_start | date: "%b %d" }} - {{ pre_end | date: "%b %d %Y" }}
                </div>
              </div>
              <div class="cal-kv-wrap">
                <div class="cal-key">
                  Deposit:
                </div>
                <div class="cal-value">
                  {{ product.price | money }}
                </div>
              </div>

              {%- if guide_list != blank -%}
                <div class="guides-wrap">
                  {%- for guide in guide_list -%}
                    {%- capture guide_pic -%}{{guide | downcase }}.jpg{%- endcapture -%}
                    <div class="guide-image-wrap">
                      <div class="guide-pic guide-image {{guide}}" style="background-image: url('{{ guide_pic | asset_url }}'); background-size: cover; background-repeat: no-repeat;"></div>
                      <div class="guide-name">{{ guide }}</div>
                    </div>
                  {%- endfor -%}
                </div>
              {%- else -%}
                <div>Guides TBA</div>
              {%- endif -%}


              {% comment %} <button class="cal-button" type="button">

                                                                <!-- ?xml version="1.0" encoding="UTF-8"? -->
                                                                <svg
                                                                  width="260px"
                                                                  height="50px"
                                                                  viewBox="0 0 260 46"
                                                                  version="1.1"
                                                                  xmlns="http://www.w3.org/2000/svg"
                                                                  xmlns:xlink="http://www.w3.org/1999/xlink">
                                                                  <defs>
                                                                    <path
                                                                      id="submit_newsletter"
                                                                      d="M 30 28 L 230 28"
                                                                      stroke="#000"></path>
                                                                  </defs>

                                                                  <polygon
                                                                    class="background"
                                                                    stroke-width="1.5"
                                                                    points="220 0 244 22 220 46 40 46 15 22 40 0"></polygon>
                                                                  <polyline
                                                                    class="arrow left"
                                                                    stroke-width="1.5"
                                                                    fill="none"
                                                                    fill-rule="evenodd"
                                                                    points="20 4 1 22 20 41"></polyline>
                                                                  <polyline
                                                                    class="arrow right"
                                                                    stroke-width="1.5"
                                                                    fill="none"
                                                                    fill-rule="evenodd"
                                                                    points="239 4 258 22 239 41"></polyline>

                                                                  <text>
                                                                    <textPath class="text-path" startOffset="50%">
                                                                      More Info
                                                                    </textPath>
                                                                  </text>

                                                                </svg>
                                                        </button> {% endcomment %}

              <span class="chevrons"></span>

            </div>
            <a href="{{ product.url }}" class="overlay-link"></a>
          </div>
        </div>
      {%- endfor -%}
    </div>
  </div>
</div>

{% schema %}
  {
    "name": "Collection Calendar",
    "tag": "section",
    "class": "spaced-section spaced-section--full-width",
    "settings": [
      {
        "type": "image_picker",
        "id": "image",
        "label": "t:sections.image-banner.settings.image.label"
      }, {
        "type": "image_picker",
        "id": "image_map",
        "label": "t:sections.image-banner.settings.image_map.label"
      }
    ],
    "presets": [
      {
        "name": "Collection Calendar"
      }
    ]
  }
{% endschema %}